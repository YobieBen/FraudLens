[tox]
# Tox configuration for multi-environment testing
envlist = py38,py39,py310,py311,coverage,benchmark,security
skipsdist = False
skip_missing_interpreters = True

[testenv]
# Base test environment
deps =
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
    pytest-cov>=4.0.0
    pytest-mock>=3.10.0
    pytest-timeout>=2.1.0
    pytest-benchmark>=4.0.0
    -r requirements.txt

commands =
    pytest {posargs}

setenv =
    PYTHONPATH = {toxinidir}
    FRAUDLENS_ENV = testing

[testenv:py{38,39,310,311}]
# Python version specific testing
commands =
    pytest tests/unit/ tests/integration/ --cov=fraudlens

[testenv:coverage]
# Coverage testing
deps =
    {[testenv]deps}
    coverage[toml]>=7.0

commands =
    coverage erase
    pytest --cov=fraudlens --cov-report=term-missing --cov-report=html --cov-report=xml
    coverage report --fail-under=80
    coverage html

[testenv:benchmark]
# Performance benchmarking
deps =
    {[testenv]deps}
    pytest-benchmark>=4.0.0
    memory-profiler>=0.60.0
    psutil>=5.9.0

commands =
    pytest tests/performance/ -m benchmark --benchmark-only

[testenv:security]
# Security testing
deps =
    {[testenv]deps}
    bandit>=1.7.0
    safety>=2.3.0

commands =
    bandit -r fraudlens/ -f json -o bandit-report.json
    safety check --json > safety-report.json

[testenv:integration]
# Integration testing
deps =
    {[testenv]deps}
    docker>=6.0.0
    requests>=2.28.0

commands =
    pytest tests/integration/ -m integration

[testenv:email]
# Email-specific testing
deps =
    {[testenv]deps}
    google-api-python-client>=2.0.0
    google-auth>=2.0.0

commands =
    pytest tests/unit/test_gmail_integration.py tests/integration/test_email_api_endpoints.py -v

[testenv:docs]
# Documentation testing
deps =
    sphinx>=5.0.0
    sphinx-rtd-theme>=1.2.0
    myst-parser>=0.18.0

commands =
    sphinx-build -b html docs/ docs/_build/html

[testenv:lint]
# Code quality checks
deps =
    flake8>=6.0.0
    black>=23.0.0
    isort>=5.12.0
    mypy>=1.0.0
    pylint>=2.17.0

commands =
    black --check fraudlens/ tests/
    isort --check-only fraudlens/ tests/
    flake8 fraudlens/ tests/
    mypy fraudlens/
    pylint fraudlens/

[testenv:format]
# Code formatting
deps =
    black>=23.0.0
    isort>=5.12.0
    autoflake>=2.0.0

commands =
    autoflake --in-place --remove-all-unused-imports --recursive fraudlens/ tests/
    isort fraudlens/ tests/
    black fraudlens/ tests/

[flake8]
# Flake8 configuration
max-line-length = 100
exclude = 
    .git,
    __pycache__,
    .tox,
    venv,
    .venv,
    dist,
    build,
    *.egg-info
ignore = E203,W503,E501

[isort]
# isort configuration
profile = black
line_length = 100
skip_gitignore = true

[mypy]
# MyPy configuration
python_version = 3.8
warn_return_any = True
warn_unused_configs = True
disallow_untyped_defs = True
ignore_missing_imports = True